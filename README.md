# Window BLE Battery Service Subscriber

This implements a Windows service which fixes Windows to correctly update the battery level for some Bluetooth devices. It watches for connected BLE devices and subscribes to the battery level characteristic of their GATT battery services, if provided.

## Installation

Download the the .msix file from the [latest release](https://github.com/joelspadin/BleBatterySubscribe/releases) and double click it to install the service.

## Development

### Requirements

* [.NET 5.0 SDK](https://dotnet.microsoft.com/en-us/download/dotnet/5.0)
* [PowerShell](https://aka.ms/powershell-release?tag=stable)

### Testing

To debug the service, open this folder in Visual Studio Code and run the ".NET Core Launch (console)" launch configuration.

To install the application in development mode, open a PowerShell window as administrator and run

```ps
./Deploy
```
or
```ps
./Deploy -debug
```

### Packaging

To install the package, it must be signed. To make a self-sign certificate for testing, open a PowerShell window as administrator and run

```ps
cd installer
# This
./MakeSelfSignCert
```

For more details, see [create a certificate for package signing](https://docs.microsoft.com/en-us/windows/msix/package/create-certificate-package-signing).

To build and sign the installer, open a PowerShell window and run

```ps
cd installer
./MakeMsix
./SignMsix
```

The SignMsix script assumes you are using the self-sign certificate generated by MakeSelfSignCert. To use a different certificate, see [sign an app package using SignTool](https://docs.microsoft.com/en-us/windows/msix/package/sign-app-package-using-signtool)

To install the package, simply run the generated `installer/bin/BleBatterySubscribe-x64.msix` file.

## Credits

Installer scripts are based in part on [microsoft/PowerToys](https://github.com/microsoft/PowerToys) ([license](https://github.com/microsoft/PowerToys/blob/main/LICENSE)).
